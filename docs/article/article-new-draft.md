# 新卒エンジニアが実践で学ぶ「Claude Code」活用術 - 広告管理システム開発で掴んだAIペアプロの知見

## はじめに：散らばった広告管理を統合したい

現在弊社では、各メディアサイトではWordPressを使って記事と広告を管理していますが、以下の課題がありました：

- 広告コンテンツの管理が各サイトに分散
- 統一的な広告効果測定ができない
- WordPressの既存プラグインは新しい広告の作成・配布が非効率

「これを統一的に管理できるシステムがあれば...」そんな思いから、実際のチーム開発の前に、個人でClaude
Codeを活用してMVP機能を開発することに挑戦しました。

## なぜClaude Codeを選んだか

新卒で開発経験が浅い私にとって、以下の点でClaude Codeが最適でした：

1. **プロジェクト全体の文脈を理解**：ファイル構造やコードベース全体を把握
2. **ターミナルとの統合**：コマンド実行からデバッグまで一貫したサポート
3. **長時間の作業セッション**：会話の継続性が保たれ、会話の履歴がローカルに残る

GitHub Copilotと違い、プロジェクト単位での深い理解が可能な点が決め手でした。

## Claude Codeを活用した開発ワークフロー

### カスタムコマンドによる定型作業の自動化

`.claude/commands/`ディレクトリにカスタムコマンドを配置することで、頻繁に使う操作を自動化しました。

**主要なカスタムコマンド**

**`/create-issue` - GitHub issue作成とブランチ作成**

- 会話コンテキストから要件を抽出し、適切なissueを生成
- 事前に用意したissueテンプレートから自動選択（bug.md / task.md）
- 既存ラベルから適切な選択
- ブランチ名の自動生成（feature/[issue番号]_[機能名]）

**`/create-pr` - コミット分割とPR作成**

- 変更内容を論理的な単位で分割してコミット
- コードベースの概要を表すREADME.mdの自動更新
- PRテンプレート適用
- 関連issue自動リンク

**`/update-pr` - 既存PR内容更新**

- リモートの最新コミットを分析してPR説明を更新
- コミット内容の自動分析
- 影響範囲の特定

**`/read-issue` - issue分析とソリューション提案**

- issue内容を分析し、実装難易度別の複数案を提示
- Bug/Task自動分類
- 関連コード特定
- MVP最小限の実装、拡張性の高い実装、完全実装の3案を提示

**`/tidy` - コードベース整理**

- 不要なコードや冗長な部分の自動検出と整理

### プロジェクトメモリ（CLAUDE.md）と@参照によるコンテキスト維持

PR毎に`/init`を実行してプロジェクトメモリを更新する習慣が重要です。

```markdown
# CLAUDE.mdに記載した内容の例

- プロジェクトの概要と目的
- APIエンドポイントの命名規則
- エラーハンドリングのパターン
- チーム固有のコーディング規約
- 頻出エラーと解決策
- 環境変数の説明
```

これにより、Claude Codeが常に最新のプロジェクト情報を把握できるようになりました。

ファイル参照とコマンド実行を組み合わせることで、コンテキストを保ちながら作業できます。

```bash
# 実際の使用例
@src/components/xxx.tsx のテストが失敗しています
エラーを解析して修正してください
```

### プランモードによる手戻り削減

複雑な機能実装前に、プランモード（Shift+Tab 2回押し）で全体設計を行うことで手戻りを削減できます。Maxプランを利用している場合、Opus
Plan Mode（プランモードのみOpusを使う）に切り替えると精度がかなり上がると同時にトークンを節約できます。

```bash
# プランモードの活用例
「xxx機能の全面リファクタリングを計画してください」
→ フェーズ分けされた詳細な実装計画を生成
```

## 直面した4つの問題

### 問題1：複数リポジトリ間の連携

**課題**：広告管理システム（Next.js）のAPI修正時、WordPress側のプラグインも修正が必要

- 2つのClaude Codeセッション間でコピペが面倒
- コンテキストと実装方法のずれが生じる
- API仕様の不整合が発生

**解決策**：`/add-dir`でWordPressリポジトリを同一セッションに統合

```bash
# WordPressプラグインディレクトリを追加
/add-dir [second-repo-path]
```

これにより実現できたこと：

- API設計の統一：両側のコードを同時修正
- データ形式の一致：JSONデータ構造を一貫管理
- デバッグの効率化：連携エラーを両方見ながら解決

### 問題2：長時間作業によるコンテキストの肥大化

**課題**：長時間作業後、無関係な情報が混在してしまう問題

- 無関係な情報がコンテキストに混在
- 同じコードの繰り返し参照でセッションが重くなる
- 作業履歴が膨大になり、本来の目的を見失う

**解決策**：Claude Codeの標準機能を活用

```bash
# 解決策1：定期的なコンテキストクリア
/clear

# 解決策2：重要じゃない前提内容をcompact化
/compact

# 解決策3：Subagentの活用
/agents  # 専門タスクごとにエージェントを分離
```

### 問題3：大規模プロジェクトでのトークン消費問題

**課題**：大規模ファイルの読み込みによるトークン消費が激しい

- 大規模ファイルの読み込みによるトークン消費が激しい
- コスト増加とレスポンス速度の低下
- セッションの上限に早く到達してしまう

**解決策**：MCPサーバーSerenaの導入によるトークン削減と精度向上

基本機能だけでは限界があったため、**Serena MCPサーバー**を導入しました。

**Serena導入の体感効果**

正直、具体的な数値測定はしていませんが、以下の点で明らかな改善を体感しました：

1. **トークン消費の削減**
    - ファイル全体を読む必要がなくなった
    - 必要な関数だけピンポイントで取得できる
    - 大規模ファイルでも気軽に調査できる

2. **調査精度の向上**
    - indexによる高速検索で、見落としがなくなった
    - memoriesで過去の調査結果を活用できる
    - 影響範囲の把握が正確になった

3. **作業効率の改善**
    - セッションを跨いでも文脈を維持できる
    - 繰り返し同じ説明をする必要がない

### 問題4：issueの粒度問題

**課題**：sub-issueの自動生成精度が低い

複雑なタスクを自動的に細分化してもらおうとしましたが、実際の開発フローに合わない粒度で分割されることが多く、かえって混乱を招きました。

**解決策**：親issueに集中させ、sub-issueは手動分割

親issueのみClaude Codeに任せ、sub-issueは開発者が手動で分割する運用に切り替えました。Claude
Codeには大きな機能単位での設計と実装に集中してもらい、細かいタスク管理は人間が行うという役割分担が効果的でした。

## 今後の展望とチーム開発への応用

### 今後試したい機能

1. **git worktreeでの並列開発**
   ```bash
   # 機能Aと機能Bを並列で開発
   git worktree add ../project-feature-a feature-a
   git worktree add ../project-feature-b feature-b
   ```

2. **画像参照での実装**
    - デザインカンプを直接読み込んでUI実装
    - スクショからのバグ修正

3. **WebFetchツール**
    - 指定URLからのコンテンツ取得
    - ドキュメント参照の自動化
    - 外部API仕様の自動取得

4. **Subagentでの並列処理**
    - 専門化されたエージェントによる効率化
    - タスクごとのコンテキスト分離

### チーム開発での活用法

**コードレビューの効率化**

```bash
# PR作成前のセルフレビュー
「このPRをレビューして改善点を指摘してください」
→ セキュリティ、パフォーマンス、可読性の観点から指摘
```

**ドキュメント自動生成**

```bash
# よく使うドキュメント生成コマンド例
「プロジェクトの現状を反映したREADMEを作成」
「新メンバー向けの環境構築手順書を作成」
「APIの仕様書を生成」
```

## まとめ：Claude Codeは開発の相棒

開発経験の浅かった私が、Claude Codeと共に本格的なシステムを構築できた理由：

1. **プロジェクト全体を理解してくれる**
    - ファイル構造、依存関係、ビジネスロジックまで把握
    - 継続的な会話で文脈を維持

2. **ベストプラクティスを提案してくれる**
    - 業界標準のコーディング規約
    - セキュリティやパフォーマンスの考慮

3. **エラーの原因を一緒に考えてくれる**
    - スタックトレースの解析
    - 段階的なデバッグアプローチ

特に新人エンジニアや、新技術に挑戦する方にとって、Claude Codeは強力な味方になるはずです。

## 参考リンク

- [Claude Code公式ドキュメント](https://docs.anthropic.com/ja/docs/claude-code)
- [Claude Code Common Workflows](https://docs.anthropic.com/ja/docs/claude-code/common-workflows)
