# åºƒå‘Šç®¡ç†ãƒ»é…ä¿¡ã‚·ã‚¹ãƒ†ãƒ 

> **é–¢é€£è³‡æ–™
**: [APIä»•æ§˜æ›¸](../api-reference.md) | [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](../architecture.md) | [WordPressçµ±åˆ](./wordpress-integration.md)

## åºƒå‘Šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€URLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ç”»åƒã‚’çµ„ã¿åˆã‚ã›ãŸå®Œå…¨ãªåºƒå‘Šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆãƒ»ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

- **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Vercel Blobã‚’ä½¿ç”¨ã—ãŸãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**: ä¸‹æ›¸ããƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ä¸€æ™‚åœæ­¢ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®4æ®µéšãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿åˆã‚ã›ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å¯¾å¿œ**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤‰æ•°ã¨ç”»åƒãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å‹•çš„çµåˆ
- **URLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé€£æº**: ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°URLç”Ÿæˆã¨ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹çµ±åˆ

### åºƒå‘Šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A[ä¸‹æ›¸ãä½œæˆ] --> B[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ]
    B --> C[ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‡ãƒ¼ã‚¿å…¥åŠ›]
    C --> D[ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    D --> E[ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèª]
    E --> F{å“è³ªãƒã‚§ãƒƒã‚¯}
    F -->|åˆæ ¼| G[ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–]
    F -->|ä¿®æ­£å¿…è¦| C
    G --> H[é‹ç”¨ç®¡ç†]
    H --> I[åŠ¹æœæ¸¬å®š]
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹     | èª¬æ˜      | è¡¨ç¤º | ç·¨é›† |
|-----------|---------|----|----|
| **ä¸‹æ›¸ã**   | ä½œæˆä¸­ãƒ»æœªå…¬é–‹ | Ã—  | â—‹  |
| **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–** | å…¬é–‹ä¸­ãƒ»é…ä¿¡ä¸­ | â—‹  | â—‹  |
| **ä¸€æ™‚åœæ­¢**  | ä¸€æ™‚çš„ãªéè¡¨ç¤º | Ã—  | â—‹  |
| **ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–** | é‹ç”¨çµ‚äº†ãƒ»ä¿å­˜ | Ã—  | Ã—  |

## åºƒå‘Šé…ä¿¡ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

WordPressçµ±åˆã«ã‚ˆã‚‹å¤–éƒ¨ã‚µã‚¤ãƒˆå‘ã‘ã®åºƒå‘Šé…ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã€‚ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ `[lmg_ad id="123"]` ã«ã‚ˆã‚‹ç°¡å˜ãªåŸ‹ã‚è¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

- **WordPressé€£æº**: ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ç°¡å˜ãªåºƒå‘ŠåŸ‹ã‚è¾¼ã¿
- **CORSå¯¾å¿œé…ä¿¡**: å¤–éƒ¨ã‚µã‚¤ãƒˆå‘ã‘ã®åºƒå‘ŠHTMLé…ä¿¡
- **ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³è¿½è·¡**: åºƒå‘Šè¡¨ç¤ºæ™‚ã®è‡ªå‹•ã‚«ã‚¦ãƒ³ãƒˆ
- **ã‚¯ãƒªãƒƒã‚¯è¿½è·¡**: é€éçš„ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ©Ÿèƒ½
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–**: å¤šå±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

### é…ä¿¡ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant WP as WordPress Site
    participant API as Next.js API
    participant DB as Database
    participant BLOB as Vercel Blob
    
    WP->>API: ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰è¦æ±‚
    API->>DB: åºƒå‘Šãƒ‡ãƒ¼ã‚¿å–å¾—
    API->>BLOB: ç”»åƒURLå–å¾—
    API->>API: HTMLãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    API->>DB: ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²
    API->>WP: å®ŒæˆHTMLè¿”å´
    
    Note over WP,API: ã‚¯ãƒªãƒƒã‚¯æ™‚
    WP->>API: ã‚¯ãƒªãƒƒã‚¯è¿½è·¡è¦æ±‚
    API->>DB: ã‚¯ãƒªãƒƒã‚¯æ•°æ›´æ–°
    API->>WP: å…ƒURLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

### WordPressçµ±åˆ

#### ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ä¾‹

```php
// åŸºæœ¬å½¢
[lmg_ad id="123"]

// ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ä»˜ã
[lmg_ad id="123" class="my-custom-ad" width="300px" height="250px"]

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“æŒ‡å®š
[lmg_ad id="123" cache="7200"]

// ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
[lmg_ad id="123" debug="true"]
```

#### å±æ€§ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| å±æ€§       | èª¬æ˜         | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤             |
|----------|------------|--------------------|
| `id`     | åºƒå‘ŠIDï¼ˆå¿…é ˆï¼‰   | -                  |
| `cache`  | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ï¼ˆç§’ï¼‰ | 3600               |
| `class`  | è¿½åŠ CSSã‚¯ãƒ©ã‚¹   | `lmg-ad-container` |
| `width`  | å¹…æŒ‡å®š        | -                  |
| `height` | é«˜ã•æŒ‡å®š       | -                  |
| `debug`  | ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰    | false              |

## ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ»è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

åºƒå‘Šã®åŠ¹æœæ¸¬å®šã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### è¿½è·¡ãƒ‡ãƒ¼ã‚¿

- **ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³è¿½è·¡**: åºƒå‘Šè¡¨ç¤ºå›æ•°ã®è‡ªå‹•ã‚«ã‚¦ãƒ³ãƒˆ
- **ã‚¯ãƒªãƒƒã‚¯è¿½è·¡**: å¤–éƒ¨ãƒªãƒ³ã‚¯ã®ã‚¯ãƒªãƒƒã‚¯æ•°æ¸¬å®š
- **æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹**: æœ€å¾Œã«è¡¨ç¤ºã•ã‚ŒãŸæ—¥æ™‚ã®è¨˜éŒ²
- **ã‚¢ã‚¯ã‚»ã‚¹å…ƒ**: ãƒªãƒ•ã‚¡ãƒ©ãƒ¼æƒ…å ±ã¨ãƒšãƒ¼ã‚¸URL

### åŠ¹æœæ¸¬å®šæŒ‡æ¨™

| æŒ‡æ¨™           | èª¬æ˜        | è¨ˆç®—æ–¹æ³•                     |
|--------------|-----------|--------------------------|
| **ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³** | åºƒå‘Šè¡¨ç¤ºå›æ•°    | é…ä¿¡APIã‚¢ã‚¯ã‚»ã‚¹æ•°               |
| **ã‚¯ãƒªãƒƒã‚¯æ•°**    | ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯å›æ•° | è¿½è·¡URLçµŒç”±ã‚¢ã‚¯ã‚»ã‚¹æ•°             |
| **CTR**      | ã‚¯ãƒªãƒƒã‚¯ç‡     | (ã‚¯ãƒªãƒƒã‚¯æ•° Ã· ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³) Ã— 100 |
| **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æœŸé–“**  | é‹ç”¨æ—¥æ•°      | ç¾åœ¨æ—¥ - ä½œæˆæ—¥                |

## ç”»åƒç®¡ç†ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

åºƒå‘Šç”»åƒã®åŠ¹ç‡çš„ãªç®¡ç†ã¨è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

- **è‡ªå‹•å‰Šé™¤**: åºƒå‘Šã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‰Šé™¤æ™‚ã®é–¢é€£ç”»åƒé€£é–å‰Šé™¤
- **å­¤ç«‹ç”»åƒæ¤œå‡º**: å‚ç…§ã•ã‚Œãªããªã£ãŸç”»åƒã®è‡ªå‹•æ¤œå‡º
- **å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: Vercel Cron Jobsã«ã‚ˆã‚‹é€±æ¬¡å®Ÿè¡Œ
- **ä½¿ç”¨çŠ¶æ³è¿½è·¡**: ç”»åƒã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é–¢é€£ä»˜ã‘ç®¡ç†

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¯¾è±¡

1. **å­¤ç«‹ã—ãŸç”»åƒ**: å‰Šé™¤ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ç´ã¥ãç”»åƒ
2. **å¤ã„ä¸‹æ›¸ãç”»åƒ**: 30æ—¥ä»¥ä¸Šä¸‹æ›¸ãçŠ¶æ…‹ã®æœªä½¿ç”¨ç”»åƒ
3. **é‡è¤‡ç”»åƒ**: åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®é‡è¤‡ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
4. **ç ´æç”»åƒ**: ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãƒ»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã®ç”»åƒ

### è‡ªå‹•å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

- **å®Ÿè¡Œé »åº¦**: æ¯é€±æ—¥æ›œæ—¥ 2:00 AM UTC
- **å®Ÿè¡Œæ–¹æ³•**: Vercel Cron Jobs
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/admin/cleanup-images`
- **èªè¨¼**: `CRON_SECRET` ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹èªè¨¼

> **ğŸ”§ è©³ç´°ãªæŠ€è¡“å®Ÿè£…**: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](../architecture.md) ã‚’å‚ç…§  
> **ğŸ“Š APIä»•æ§˜**: åºƒå‘Šé…ä¿¡ãƒ»ç®¡ç†ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ [APIä»•æ§˜æ›¸](../api-reference.md) ã‚’å‚ç…§  
> **ğŸ”— WordPressé€£æº**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…æ–¹æ³•ã¯ [WordPressçµ±åˆ](./wordpress-integration.md) ã‚’å‚ç…§
